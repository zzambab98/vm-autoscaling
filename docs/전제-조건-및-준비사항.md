# 전제 조건 및 준비사항

**작성일**: 2025-11-20  
**버전**: 1.0

---

## 📋 개요

VM 오토스케일링 자동화 시스템을 사용하기 전에 반드시 충족되어야 하는 전제 조건과 준비사항을 설명합니다.

---

## ✅ 필수 전제 조건

### 1. 기존 서버 배포 완료

#### 요구사항
- **최소 2대 이상의 VM이 이미 배포되어 있어야 함**
- 각 서버는 고정 IP를 사용하고 있어야 함
- 서버에 웹/API 서비스가 구성되어 정상 동작 중이어야 함

#### 예시
```
서버 1: Web-Server-01
  - IP: 10.255.1.101
  - 서비스: 웹 서버 (Nginx/Apache)
  - 상태: 정상 동작 중

서버 2: Web-Server-02
  - IP: 10.255.1.102
  - 서비스: 웹 서버 (Nginx/Apache)
  - 상태: 정상 동작 중
```

#### 확인 방법
```bash
# 서버 접속 및 서비스 상태 확인
ssh ubuntu@10.255.1.101
systemctl status nginx  # 또는 apache2, node 등

# 서비스 응답 확인
curl http://10.255.1.101/health
curl http://10.255.1.102/health
```

---

### 2. F5 L4 Pool 구성 완료

#### 요구사항
- **F5 L4 Pool이 이미 생성되어 있어야 함**
- 기존 서버들이 F5 Pool Member로 등록되어 있어야 함
- Virtual Server (VIP)가 구성되어 있어야 함
- Health Check가 정상 동작 중이어야 함

#### 예시
```
F5 Pool 정보:
  - Pool 이름: web-server-pool
  - VIP: 10.255.1.100:80
  - 기존 Member:
    * 10.255.1.101:80 (Web-Server-01)
    * 10.255.1.102:80 (Web-Server-02)
  - Load Balancing: Round Robin
  - Health Monitor: HTTP (경로: /health)
  - 상태: 모든 Member 정상 (available)
```

#### 확인 방법
```bash
# F5 BIG-IP에 접속하여 Pool 상태 확인
# 또는 F5 iControl REST API 사용
curl -k -u admin:password \
  https://10.255.1.80/mgmt/tm/ltm/pool/~Common~web-server-pool/members

# VIP를 통한 서비스 접속 확인
curl http://10.255.1.100/
```

#### 중요 사항
- ⚠️ **오토스케일링 시스템은 기존 Pool에 새 Member를 추가하는 방식**
- ⚠️ **새로운 Pool을 생성하지 않음**
- ⚠️ **기존 Pool이 없으면 오토스케일링 설정 시 오류 발생**

---

### 3. PLG Stack 모니터링 설정

#### 요구사항
- **Prometheus가 기존 서버들을 모니터링 중이어야 함**
- Node Exporter 또는 vCenter Exporter가 설치되어 있어야 함
- 기본적인 Alert Rule이 설정되어 있어야 함

#### 예시
```yaml
# Prometheus 설정 (prometheus.yml)
scrape_configs:
  - job_name: 'web-server-service'
    static_configs:
      - targets: 
          - '10.255.1.101:9100'  # Web-Server-01 Node Exporter
          - '10.255.1.102:9100'  # Web-Server-02 Node Exporter
        labels:
          instance: 'web-server-service'
          service: 'web-server'
```

#### 확인 방법
```bash
# Prometheus UI에서 확인
# http://10.255.1.254:9090

# 메트릭 조회
curl 'http://10.255.1.254:9090/api/v1/query?query=up{job="web-server-service"}'

# 서버에 Node Exporter 설치 확인
ssh ubuntu@10.255.1.101
systemctl status node_exporter
curl http://localhost:9100/metrics
```

---

### 4. 템플릿 준비

#### 요구사항
- **배포된 서버 중 하나를 템플릿으로 변환할 수 있어야 함**
- 템플릿은 동일한 서비스 구성을 가지고 있어야 함
- 템플릿은 오토스케일링 설정 시 생성됨 (사전 준비 불필요)

#### 템플릿 생성 시점
- 오토스케일링 설정 생성 시 운영자가 웹 UI에서 템플릿 생성
- 기존 서버 중 하나를 선택하여 템플릿으로 변환

---

## 🔧 선택적 준비사항

### 1. IP Pool 준비

#### 권장사항
- 오토스케일링을 위해 충분한 IP 범위를 준비
- 기존 서버 IP와 겹치지 않는 범위 설정

#### 예시
```
기존 서버 IP:
  - 10.255.1.101 (Web-Server-01)
  - 10.255.1.102 (Web-Server-02)

오토스케일링용 IP Pool:
  - 시작: 10.255.1.200
  - 종료: 10.255.1.250
  - 사용 가능한 IP: 51개
```

### 2. VLAN 정보

#### 권장사항
- 기존 서버와 동일한 VLAN 사용
- 또는 별도 VLAN 구성 (네트워크 정책에 따라)

### 3. SSH 키

#### 권장사항
- VM 생성 시 사용할 SSH 키 준비
- 또는 템플릿에 SSH 키가 이미 포함되어 있으면 불필요

---

## ❌ 지원하지 않는 시나리오

### 1. 처음부터 서버 배포
- ⚠️ **이 시스템은 기존 서버가 없으면 사용할 수 없음**
- 먼저 최소 2대 이상의 서버를 배포해야 함

### 2. F5 Pool 자동 생성
- ⚠️ **F5 Pool은 사전에 생성되어 있어야 함**
- 이 시스템은 기존 Pool에 Member를 추가하는 기능만 제공
- Pool 생성은 수동으로 또는 다른 시스템을 통해 수행

### 3. 단일 서버 환경
- ⚠️ **최소 2대 이상의 서버가 필요**
- 단일 서버 환경에서는 오토스케일링의 의미가 없음

---

## ✅ 체크리스트

오토스케일링 설정 전에 다음 항목을 확인하세요:

### 서버 관련
- [ ] 최소 2대 이상의 VM이 배포되어 있음
- [ ] 각 서버가 고정 IP를 사용하고 있음
- [ ] 서버에 웹/API 서비스가 구성되어 정상 동작 중
- [ ] 서버에 Node Exporter가 설치되어 있음 (또는 vCenter Exporter 설정)

### F5 관련
- [ ] F5 L4 Pool이 생성되어 있음
- [ ] 기존 서버들이 F5 Pool Member로 등록되어 있음
- [ ] Virtual Server (VIP)가 구성되어 있음
- [ ] Health Check가 정상 동작 중
- [ ] VIP를 통한 서비스 접속이 정상 동작

### PLG Stack 관련
- [ ] Prometheus가 기존 서버들을 모니터링 중
- [ ] Prometheus에서 메트릭 수집이 정상 동작
- [ ] Alertmanager가 설정되어 있음
- [ ] 기본 Alert Rule이 설정되어 있음 (선택사항)

### 네트워크 관련
- [ ] 오토스케일링용 IP Pool 범위가 준비되어 있음
- [ ] IP Pool 범위가 기존 서버 IP와 겹치지 않음
- [ ] VLAN 정보가 확인됨

---

## 📝 준비 완료 확인

다음 명령어로 준비 상태를 확인할 수 있습니다:

```bash
# 1. 서버 상태 확인
for ip in 10.255.1.101 10.255.1.102; do
  echo "Checking $ip..."
  ssh ubuntu@$ip "systemctl status nginx || systemctl status apache2"
done

# 2. F5 Pool 상태 확인
curl -k -u admin:password \
  https://10.255.1.80/mgmt/tm/ltm/pool/~Common~web-server-pool/members

# 3. Prometheus 메트릭 확인
curl 'http://10.255.1.254:9090/api/v1/query?query=up{job="web-server-service"}'

# 4. VIP 접속 확인
curl http://10.255.1.100/health
```

모든 항목이 정상이면 오토스케일링 설정을 시작할 수 있습니다.

---

## 🚀 다음 단계

준비가 완료되면:

1. **템플릿 생성**: 웹 UI에서 기존 서버 중 하나를 템플릿으로 변환
2. **오토스케일링 설정**: 웹 UI에서 오토스케일링 설정 생성
3. **모니터링 시작**: PLG Stack이 자동으로 모니터링 시작
4. **자동 스케일아웃 대기**: 부하 증가 시 자동으로 VM 추가

---

**작성자**: Dana Cloud Automation Team  
**최종 수정일**: 2025-11-20

