# VM 오토스케일링 관리 시스템 사용 가이드

## 📋 목차
1. [시스템 개요](#시스템-개요)
2. [초기 설정 순서](#초기-설정-순서)
3. [단계별 상세 가이드](#단계별-상세-가이드)
4. [모니터링 및 관리](#모니터링-및-관리)
5. [문제 해결](#문제-해결)

---

## 시스템 개요

VM 오토스케일링 관리 시스템은 vSphere 환경에서 VM을 자동으로 스케일아웃/스케일인하는 시스템입니다.

### 주요 기능
- **템플릿 관리**: VM을 템플릿으로 변환하여 재사용
- **오토스케일링 설정**: CPU/메모리 임계값 기반 자동 스케일링 규칙 설정
- **Node Exporter 설치**: 메트릭 수집을 위한 Node Exporter 자동 설치
- **PLG Stack 연동**: Prometheus, Loki, Grafana 연동
- **모니터링 대시보드**: 실시간 메트릭 및 알림 확인
- **스케일아웃 이벤트**: 자동 스케일링 이벤트 히스토리 확인

---

## 초기 설정 순서

VM 오토스케일링을 설정하려면 다음 순서대로 진행하세요:

```
1단계: 템플릿 생성
   ↓
2단계: Node Exporter 설치
   ↓
3단계: PLG Stack 모니터링 등록
   ↓
4단계: 오토스케일링 설정 생성
   ↓
5단계: 모니터링 대시보드 확인
```

---

## 단계별 상세 가이드

### 1단계: 템플릿 생성

**목적**: 스케일아웃 시 사용할 VM 템플릿을 생성합니다.

#### 작업 순서

1. **"템플릿 관리"** 탭 클릭
2. **템플릿 생성** 섹션에서 정보 입력:
   - **원본 VM 이름**: 템플릿으로 변환할 VM 이름 입력
     - 예: `auto-vm-test-01`
   - **템플릿 이름**: 생성할 템플릿 이름 입력
     - 예: `auto-vm-test-web-template`
   - **설명**: (선택사항) 템플릿에 대한 설명
3. **"템플릿 생성"** 버튼 클릭
4. 생성 완료까지 대기 (5-10분 소요)

#### 주의사항
- 템플릿 생성 중에는 원본 VM을 사용할 수 없습니다
- 원본 VM이 실행 중이면 자동으로 종료됩니다
- 템플릿 생성은 시간이 걸릴 수 있습니다 (5-10분)

#### 확인 방법
- **템플릿 목록**에서 생성된 템플릿 확인
- "새로고침" 버튼으로 최신 상태 확인

---

### 2단계: Node Exporter 설치

**목적**: 메트릭 수집을 위해 각 VM에 Node Exporter를 설치합니다.

#### 작업 순서

1. **"Node Exporter 설치"** 탭 클릭
2. **SSH 설정**:
   - **SSH 사용자**: 일반적으로 `ubuntu`
   - **SSH Key 선택**: 서버에 접속 가능한 SSH 키 선택
     - `danainfra` 또는 `dana-cocktail` 중 선택
     - 또는 "직접 입력"으로 키 경로 입력
3. **서버 목록 확인**:
   - 서버 이름과 IP 주소 확인
   - 각 서버의 상태 확인 (설치됨/미설치)
4. **설치 방법 선택**:
   - **전체 설치**: 모든 서버에 한 번에 설치
   - **개별 설치**: 서버별로 개별 설치
5. **"전체 설치"** 또는 개별 **"설치"** 버튼 클릭
6. 설치 완료 대기

#### 확인 방법
- 각 서버의 상태가 "설치됨"으로 변경되는지 확인
- "전체 상태 확인" 버튼으로 최신 상태 확인

#### 문제 해결
- **SSH 인증 실패**: 올바른 SSH 키를 선택했는지 확인
- **설치 실패**: 서버에 SSH 접속이 가능한지 확인

---

### 3단계: PLG Stack 모니터링 등록

**목적**: Prometheus가 메트릭을 수집할 수 있도록 Job을 등록합니다.

#### 작업 순서

1. **"PLG Stack 모니터링 등록"** 탭 클릭
2. **Target 추가**:
   - **IP 주소**: Node Exporter가 설치된 서버 IP 입력
     - 예: `10.255.48.230`
   - **포트**: 일반적으로 `9100` (Node Exporter 기본 포트)
   - **활성화**: 체크박스로 활성화/비활성화
3. **"+" 버튼**으로 여러 Target 추가 가능
4. **"Prometheus Job 등록"** 버튼 클릭
5. 등록 완료 확인

#### 확인 방법
- **"Target 상태 확인"** 버튼으로 등록된 Target의 상태 확인
- 상태가 "UP"이면 정상 작동 중

---

### 4단계: 오토스케일링 설정 생성

**목적**: 자동 스케일링 규칙을 설정합니다.

#### 작업 순서

1. **"오토스케일링 설정"** 탭 클릭
2. **"새 설정 생성"** 버튼 클릭
3. **기본 정보** 입력:
   - **서비스 이름**: 오토스케일링 대상 서비스 이름
     - 예: `auto-vm-test-service`
   - **템플릿 선택**: 1단계에서 생성한 템플릿 선택
4. **모니터링 설정** 입력:
   - **CPU 임계값 (%)**: 스케일아웃 트리거 CPU 사용률
     - 예: `80` (80% 이상 시 스케일아웃)
   - **Memory 임계값 (%)**: 스케일아웃 트리거 메모리 사용률
     - 예: `80`
   - **지속 시간 (분)**: 임계값 초과 지속 시간
     - 예: `5` (5분 동안 지속되면 스케일아웃)
   - **Prometheus Job 이름**: 3단계에서 등록한 Job 이름
     - 예: `auto-vm-test-service`
5. **스케일링 설정** 입력:
   - **최소 VM 수**: 항상 유지할 최소 VM 개수
     - 예: `2`
   - **최대 VM 수**: 최대 생성 가능한 VM 개수
     - 예: `10`
   - **Scale Out Step**: 한 번에 추가할 VM 개수
     - 예: `1`
   - **Scale In Step**: 한 번에 제거할 VM 개수
     - 예: `1`
   - **Cooldown Period (초)**: 스케일링 후 대기 시간
     - 예: `300` (5분)
6. **F5 설정** 입력:
   - **Pool 이름**: F5 로드밸런서 Pool 이름
     - 예: `auto-vm-test-pool`
   - **VIP 주소**: 가상 IP 주소
     - 예: `10.255.48.229`
   - **VIP 포트**: 가상 IP 포트
     - 예: `80`
   - **Health Check 경로**: 헬스체크 경로
     - 예: `/health`
7. **네트워크 설정** 입력:
   - **IP Pool 시작 주소**: 사용 가능한 IP 범위 시작
     - 예: `10.255.48.220`
   - **IP Pool 종료 주소**: 사용 가능한 IP 범위 종료
     - 예: `10.255.48.225`
   - **서브넷**: 서브넷 마스크
     - 예: `255.255.255.0`
   - **게이트웨이**: (선택사항)
   - **VLAN**: (선택사항)
8. **"생성"** 버튼 클릭
9. 생성 완료 확인

#### 설정 활성화/비활성화
- 설정 목록에서 **"활성화"** 또는 **"비활성화"** 버튼으로 제어
- 활성화된 설정만 자동 스케일링이 작동합니다

---

### 5단계: 모니터링 대시보드 확인

**목적**: 실시간 메트릭과 알림을 확인합니다.

#### 작업 순서

1. **"모니터링 대시보드"** 탭 클릭
2. **서비스 선택**: 드롭다운에서 모니터링할 서비스 선택
3. **기간 선택**: 메트릭 조회 기간 선택 (15분, 30분, 1시간, 6시간, 24시간)
4. **메트릭 확인**:
   - **CPU 사용률**: 그래프로 CPU 사용률 추이 확인
   - **메모리 사용률**: 그래프로 메모리 사용률 추이 확인
   - **현재 값**: 현재 CPU/메모리 사용률 확인
5. **알림 확인**: Prometheus 알림 목록 확인

---

## 모니터링 및 관리

### 스케일아웃 이벤트 확인

1. **"스케일아웃 이벤트"** 탭 클릭
2. **필터링**:
   - 서비스별 필터링
   - 상태별 필터링 (성공/실패/진행중)
3. **이벤트 상세 확인**:
   - 이벤트 발생 시간
   - 트리거된 알림
   - 생성된 VM 정보
   - Jenkins Job 상태

### 템플릿 관리

- **템플릿 목록**: 생성된 모든 템플릿 확인
- **템플릿 삭제**: 더 이상 사용하지 않는 템플릿 삭제

### 오토스케일링 설정 관리

- **설정 목록**: 모든 오토스케일링 설정 확인
- **설정 수정**: 기존 설정 수정
- **설정 삭제**: 더 이상 사용하지 않는 설정 삭제
- **활성화/비활성화**: 설정의 활성화 상태 변경

---

## 문제 해결

### 템플릿 생성 실패
- **원인**: vCenter 연결 정보 미설정 또는 VM 이름 오류
- **해결**: 
  - 환경변수 확인 (GOVC_URL, GOVC_USERNAME, GOVC_PASSWORD)
  - VM 이름이 정확한지 확인

### Node Exporter 설치 실패
- **원인**: SSH 인증 실패 또는 네트워크 문제
- **해결**:
  - 올바른 SSH 키 선택
  - 서버에 SSH 접속 가능한지 확인
  - 방화벽 설정 확인 (포트 9100)

### PLG Stack 모니터링 등록 실패
- **원인**: Prometheus 서버 접근 불가 또는 Target 접속 불가
- **해결**:
  - Prometheus 서버 연결 확인
  - Node Exporter가 정상 작동하는지 확인
  - 네트워크 연결 확인

### 오토스케일링이 작동하지 않음
- **원인**: 설정이 비활성화되어 있거나 알림 규칙 미생성
- **해결**:
  - 설정이 활성화되어 있는지 확인
  - Prometheus Alert Rule이 생성되었는지 확인
  - Alertmanager 라우팅 규칙 확인

### 모니터링 데이터가 표시되지 않음
- **원인**: Prometheus Job 미등록 또는 메트릭 수집 실패
- **해결**:
  - PLG Stack 모니터링 등록 확인
  - Node Exporter 설치 확인
  - Prometheus Target 상태 확인

---

## 빠른 참조

### 권장 설정 값

| 항목 | 권장 값 | 설명 |
|------|---------|------|
| CPU 임계값 | 80% | CPU 사용률이 80% 이상이면 스케일아웃 |
| Memory 임계값 | 80% | 메모리 사용률이 80% 이상이면 스케일아웃 |
| 지속 시간 | 5분 | 임계값 초과가 5분 지속되면 스케일아웃 |
| 최소 VM 수 | 2 | 항상 최소 2개의 VM 유지 |
| 최대 VM 수 | 10 | 최대 10개까지 VM 생성 |
| Cooldown Period | 300초 | 스케일링 후 5분 대기 |

### 접속 정보

- **프론트엔드**: http://localhost:5520
- **백엔드 API**: http://localhost:4410
- **Health Check**: http://localhost:4410/health

---

## 추가 도움말

문제가 지속되면:
1. 브라우저 개발자 도구 콘솔 확인 (F12)
2. 백엔드 로그 확인: `tail -f logs/backend.log`
3. 프론트엔드 로그 확인: `tail -f logs/frontend.log`

