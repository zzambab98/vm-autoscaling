# VM 오토스케일링 시스템 작업 완료 내역 및 향후 계획

**작성일**: 2025-11-27  
**버전**: 1.0  
**프로젝트**: DanaIX VM 오토스케일링 자동화 시스템

---

## 📋 목차

1. [완료된 작업](#완료된-작업)
2. [현재 시스템 상태](#현재-시스템-상태)
3. [향후 필요한 작업](#향후-필요한-작업)
4. [테스트 계획](#테스트-계획)
5. [알려진 이슈](#알려진-이슈)

---

## ✅ 완료된 작업

### 1. 기본 인프라 및 설정

#### 1.1 포트 설정 및 충돌 해결
- ✅ 백엔드 포트: `6010` (기존 4410에서 변경)
- ✅ 프론트엔드 포트: `5520` (유지)
- ✅ 포트 충돌 문제 해결 (다른 프로젝트와 분리)
- ✅ `run-dev.sh`, `stop-dev.sh` 스크립트에 포트 하드코딩
- ✅ 환경 변수 기반 포트 설정 제거

#### 1.2 vCenter 연동
- ✅ vCenter 연결 정보 설정 (GOVC_URL, GOVC_USERNAME, GOVC_PASSWORD)
- ✅ vCenter에서 VM 목록 조회 기능 구현
- ✅ vCenter에서 템플릿 목록 자동 조회 기능 구현
- ✅ VM IP 주소 자동 조회 기능 (`govc vm.ip` 사용)
- ✅ vCLS-로 시작하는 VM 자동 필터링

### 2. 프론트엔드 UI/UX 개선

#### 2.1 DanaIX 브랜딩 적용
- ✅ DanaIX 색상 팔레트 적용
- ✅ DanaIX 폰트 적용 (Poppins)
- ✅ 로고 및 파비콘 업데이트
- ✅ 헤더 디자인 개선
- ✅ 카드 및 테이블 테두리 가시성 개선

#### 2.2 메뉴 구조 개선
- ✅ 메뉴 순서 재정렬 (운영 순서대로):
  1. 템플릿 관리
  2. Node Exporter 설치
  3. PLG Stack 모니터링 등록
  4. 오토스케일링 설정
  5. Alertmanager 라우팅
  6. 모니터링 대시보드
  7. 스케일아웃 이벤트

#### 2.3 Node Exporter 설치 화면 개선
- ✅ VM 목록 자동 조회 기능
- ✅ VM IP 주소 자동 표시
- ✅ IP가 여러 개일 때 선택 버튼 표시
- ✅ VM 목록 이름 기준 정렬
- ✅ vCLS-로 시작하는 VM 숨김 처리
- ✅ 자동 새로고침 기능 (탭 클릭 시)

#### 2.4 템플릿 관리 화면 개선
- ✅ vCenter에서 템플릿 목록 자동 조회
- ✅ 로컬 메타데이터와 vCenter 템플릿 병합
- ✅ 자동 새로고침 기능 (탭 클릭 시)

### 3. 백엔드 기능 개선

#### 3.1 Prometheus Job 관리
- ✅ Prometheus Job 등록 기능
- ✅ Prometheus Job 삭제 기능
- ✅ 시스템 중요 Job 숨김 처리 (prometheus, alertmanager, loki)
- ✅ 각 Target에 고유한 instance 라벨 할당

#### 3.2 Alert Rule 개선
- ✅ Alert Rule 생성 시 `max()` 집계 사용
- ✅ 단일 인스턴스가 임계값 초과 시 알림 발생
- ✅ CPU/Memory 사용률 쿼리 정확도 개선

#### 3.3 Grafana 대시보드 자동 생성
- ✅ Prometheus Job 등록 시 Grafana 대시보드 자동 생성
- ✅ 대시보드 삭제 기능 (Job 삭제 시)
- ✅ 대시보드 URL 반환

#### 3.4 Alertmanager 라우팅
- ✅ Jenkins Webhook URL 직접 연결 (백엔드 프록시 제거)
- ✅ 서비스별 라우팅 규칙 자동 생성
- ✅ Jenkins 설정 기본값 적용

#### 3.5 Jenkins 연동
- ✅ Jenkins API 인증 정보 업데이트 (leo 사용자)
- ✅ Webhook 토큰 업데이트
- ✅ Jenkins Job 자동 생성 기능

#### 3.6 성능 최적화
- ✅ VM IP 조회 병렬 처리 (Promise.all 사용)
- ✅ 타임아웃 설정 최적화 (3초)
- ✅ 프론트엔드 API 타임아웃 증가 (60초)

### 4. 문서화

#### 4.1 문서 업데이트
- ✅ 사용자 가이드 포트 정보 업데이트 (6010)
- ✅ 작업 완료 내역 문서화

---

## 📊 현재 시스템 상태

### 시스템 아키텍처

```
[프론트엔드: 5520] ←→ [백엔드: 6010] ←→ [vCenter] ←→ [PLG Stack] ←→ [Jenkins]
```

### 주요 기능 상태

| 기능 | 상태 | 비고 |
|------|------|------|
| 템플릿 관리 | ✅ 완료 | vCenter 자동 조회 |
| VM 목록 조회 | ✅ 완료 | IP 자동 조회, 정렬 |
| Node Exporter 설치 | ✅ 완료 | UI 개선 완료 |
| Prometheus Job 등록 | ✅ 완료 | Grafana 대시보드 자동 생성 |
| Alert Rule 생성 | ✅ 완료 | max() 집계 적용 |
| Alertmanager 라우팅 | ✅ 완료 | Jenkins 직접 연결 |
| 오토스케일링 설정 | ✅ 완료 | Jenkins 연동 완료 |
| 모니터링 대시보드 | ✅ 완료 | 개별 인스턴스 표시 |
| 스케일아웃 이벤트 | ✅ 완료 | 이벤트 목록 표시 |

### 환경 변수 설정

```bash
# vCenter
GOVC_URL=https://10.255.0.10/
GOVC_USERNAME=administrator@vsphere.local
GOVC_PASSWORD=VMware1!
GOVC_INSECURE=1

# Jenkins
JENKINS_URL=http://10.255.0.103:8080
JENKINS_WEBHOOK_USER=leo
JENKINS_WEBHOOK_PASSWORD=11c729d250790bec23d77c6144053e7b03
JENKINS_DEFAULT_WEBHOOK_TOKEN=11c729d250790bec23d77c6144053e7b03

# PLG Stack
PLG_STACK_SERVER=10.255.1.254
PLG_STACK_USER=ubuntu
PLG_STACK_SSH_KEY=/path/to/ssh/key

# F5
F5_SERVERS=10.255.1.80
F5_USER=admin
F5_PASSWORD=Netcom123!@#
```

---

## 🔜 향후 필요한 작업

### 1. 핵심 기능 테스트 및 검증

#### 1.1 End-to-End 테스트
- [ ] 전체 워크플로우 테스트
  1. 템플릿 생성 → Node Exporter 설치 → Prometheus 등록 → 오토스케일링 설정 → 실제 스케일아웃 트리거
- [ ] 실제 부하 테스트
  - CPU/Memory 부하 발생 → Alert 발생 → Jenkins 파이프라인 실행 → VM 생성 확인
- [ ] 스케일인 기능 테스트
  - 부하 감소 시 VM 자동 제거 기능

#### 1.2 각 컴포넌트별 테스트
- [ ] Prometheus Job 등록/삭제 테스트
- [ ] Alert Rule 정확도 검증
- [ ] Alertmanager 라우팅 규칙 검증
- [ ] Jenkins Webhook 전송 검증
- [ ] Grafana 대시보드 생성/삭제 검증
- [ ] vCenter VM 클론 기능 테스트
- [ ] F5 Pool Member 추가 기능 테스트

### 2. 에러 처리 및 예외 상황 대응

#### 2.1 에러 처리 개선
- [ ] vCenter 연결 실패 시 사용자 친화적 메시지
- [ ] Jenkins 연결 실패 시 재시도 로직
- [ ] Prometheus/Alertmanager 연결 실패 처리
- [ ] 네트워크 타임아웃 처리 개선
- [ ] 부분 실패 시 롤백 기능

#### 2.2 예외 상황 대응
- [ ] VM 클론 실패 시 처리
- [ ] IP Pool 고갈 시 처리
- [ ] F5 Pool Member 추가 실패 시 처리
- [ ] Node Exporter 설치 실패 시 재시도

### 3. UI/UX 개선

#### 3.1 사용성 개선
- [ ] 로딩 상태 표시 개선
- [ ] 진행 상황 표시 (Progress Bar)
- [ ] 작업 완료 알림 (Toast 메시지)
- [ ] 에러 메시지 개선
- [ ] 도움말/툴팁 추가

#### 3.2 데이터 시각화
- [ ] 모니터링 대시보드 그래프 개선
- [ ] 실시간 메트릭 업데이트
- [ ] 히스토리 데이터 표시
- [ ] 알림 이벤트 타임라인

### 4. 보안 및 인증

#### 4.1 인증/인가
- [ ] 사용자 인증 기능 추가
- [ ] 역할 기반 접근 제어 (RBAC)
- [ ] API 키 기반 인증
- [ ] 세션 관리

#### 4.2 보안 강화
- [ ] HTTPS 적용
- [ ] 민감 정보 암호화
- [ ] API Rate Limiting
- [ ] 입력 값 검증 강화

### 5. 모니터링 및 로깅

#### 5.1 로깅 개선
- [ ] 구조화된 로깅 (JSON 형식)
- [ ] 로그 레벨 관리
- [ ] 로그 로테이션
- [ ] 에러 추적 시스템 연동

#### 5.2 모니터링
- [ ] 시스템 헬스 체크
- [ ] 성능 메트릭 수집
- [ ] 알림 시스템 연동
- [ ] 대시보드 개선

### 6. 성능 최적화

#### 6.1 쿼리 최적화
- [ ] Prometheus 쿼리 최적화
- [ ] 대량 데이터 처리 개선
- [ ] 캐싱 전략 도입

#### 6.2 병렬 처리
- [ ] 대량 VM 처리 시 배치 처리
- [ ] 비동기 작업 큐 도입
- [ ] 워커 프로세스 분리

### 7. 데이터베이스 마이그레이션

#### 7.1 JSON → 데이터베이스
- [ ] PostgreSQL 또는 MongoDB 도입
- [ ] 데이터 마이그레이션 스크립트
- [ ] 트랜잭션 지원
- [ ] 데이터 백업/복구

### 8. 문서화

#### 8.1 사용자 문서
- [ ] 상세 사용자 가이드
- [ ] API 문서 (Swagger/OpenAPI)
- [ ] 트러블슈팅 가이드
- [ ] FAQ 문서

#### 8.2 개발자 문서
- [ ] 아키텍처 문서
- [ ] 개발 환경 설정 가이드
- [ ] 코드 리뷰 가이드
- [ ] 배포 가이드

---

## 🧪 테스트 계획

### 1. 단위 테스트 (Unit Tests)

#### 1.1 백엔드 서비스 테스트
- [ ] `templateService.js` 테스트
  - 템플릿 목록 조회
  - VM 목록 조회
  - IP 주소 조회
  - 템플릿 생성/삭제
- [ ] `prometheusMonitoringService.js` 테스트
  - Job 등록/삭제
  - Target 추가/제거
- [ ] `prometheusAlertService.js` 테스트
  - Alert Rule 생성/삭제
  - 쿼리 정확도 검증
- [ ] `alertmanagerService.js` 테스트
  - 라우팅 규칙 추가/삭제
  - Receiver 생성
- [ ] `grafanaService.js` 테스트
  - 대시보드 생성/삭제
- [ ] `jenkinsService.js` 테스트
  - Job 생성/삭제
  - Webhook 트리거
- [ ] `autoscalingService.js` 테스트
  - 설정 CRUD
  - 상태 변경

#### 1.2 프론트엔드 컴포넌트 테스트
- [ ] `TemplateList.jsx` 테스트
- [ ] `NodeExporterInstall.jsx` 테스트
- [ ] `PrometheusMonitoring.jsx` 테스트
- [ ] `AutoscalingConfigForm.jsx` 테스트
- [ ] `MonitoringDashboard.jsx` 테스트

### 2. 통합 테스트 (Integration Tests)

#### 2.1 API 통합 테스트
- [ ] 템플릿 관리 API
- [ ] VM 목록 조회 API
- [ ] Prometheus Job 관리 API
- [ ] Alert Rule 관리 API
- [ ] 오토스케일링 설정 API
- [ ] Webhook 처리 API

#### 2.2 외부 시스템 연동 테스트
- [ ] vCenter 연동 테스트
- [ ] Prometheus 연동 테스트
- [ ] Alertmanager 연동 테스트
- [ ] Grafana 연동 테스트
- [ ] Jenkins 연동 테스트
- [ ] F5 연동 테스트

### 3. E2E 테스트 (End-to-End Tests)

#### 3.1 전체 워크플로우 테스트
```
시나리오 1: 새로운 서비스 오토스케일링 설정
1. 템플릿 생성 (vCenter에서)
2. Node Exporter 설치 (2대 VM)
3. Prometheus Job 등록
4. 오토스케일링 설정 생성
5. Alert Rule 생성 확인
6. Alertmanager 라우팅 규칙 확인
7. 부하 발생 → Alert 발생 → Jenkins 파이프라인 실행
8. 새 VM 생성 확인
9. F5 Pool Member 추가 확인
10. 모니터링 대시보드에서 새 VM 확인
```

```
시나리오 2: 기존 서비스 스케일아웃
1. 기존 오토스케일링 설정 활성화
2. CPU 부하 발생 (stress-ng 사용)
3. Alert 발생 확인
4. Jenkins 파이프라인 실행 확인
5. 새 VM 생성 확인
6. 서비스 확장 확인
```

```
시나리오 3: 스케일인 (부하 감소)
1. 부하 감소
2. 스케일인 정책 확인
3. VM 제거 확인
4. F5 Pool Member 제거 확인
```

### 4. 성능 테스트

#### 4.1 부하 테스트
- [ ] 동시 사용자 테스트
- [ ] 대량 VM 처리 테스트 (100개 이상)
- [ ] API 응답 시간 측정
- [ ] 메모리 사용량 모니터링
- [ ] CPU 사용량 모니터링

#### 4.2 스트레스 테스트
- [ ] 최대 VM 수 테스트
- [ ] 동시 스케일아웃 이벤트 처리
- [ ] 네트워크 지연 시뮬레이션
- [ ] 외부 시스템 장애 시뮬레이션

### 5. 보안 테스트

#### 5.1 취약점 테스트
- [ ] SQL Injection 테스트
- [ ] XSS 테스트
- [ ] CSRF 테스트
- [ ] 인증 우회 테스트
- [ ] 권한 상승 테스트

#### 5.2 보안 스캔
- [ ] 의존성 취약점 스캔
- [ ] 코드 보안 스캔
- [ ] 네트워크 보안 스캔

### 6. 사용성 테스트

#### 6.1 UI/UX 테스트
- [ ] 사용자 시나리오 테스트
- [ ] 접근성 테스트
- [ ] 반응형 디자인 테스트
- [ ] 브라우저 호환성 테스트

---

## ⚠️ 알려진 이슈

### 1. 현재 제한사항

#### 1.1 기능 제한
- ❌ 스케일인 기능 미구현 (부하 감소 시 VM 자동 제거)
- ❌ IP Pool 자동 관리 미구현
- ❌ VM 상태 모니터링 제한적
- ❌ 롤백 기능 미구현

#### 1.2 성능 제한
- ⚠️ 대량 VM 처리 시 시간 소요 (25개 VM 약 3-5초)
- ⚠️ IP 조회 실패 시 타임아웃 발생 가능
- ⚠️ 동시 스케일아웃 이벤트 처리 제한

#### 1.3 보안 제한
- ⚠️ 사용자 인증 미구현
- ⚠️ HTTPS 미적용
- ⚠️ API Rate Limiting 미구현

### 2. 개선 필요 사항

#### 2.1 에러 처리
- ⚠️ 부분 실패 시 롤백 로직 필요
- ⚠️ 재시도 로직 개선 필요
- ⚠️ 사용자 친화적 에러 메시지 필요

#### 2.2 모니터링
- ⚠️ 시스템 헬스 체크 강화 필요
- ⚠️ 로깅 개선 필요
- ⚠️ 알림 시스템 연동 필요

---

## 📝 참고 사항

### 개발 환경
- **OS**: macOS (darwin 25.1.0)
- **Node.js**: v24.6.0
- **Backend**: Node.js + Express
- **Frontend**: React + Vite
- **vCenter**: VMware vCenter Server 8.0.3

### 주요 도구
- **govc**: vCenter CLI 도구
- **Prometheus**: 메트릭 수집
- **Alertmanager**: 알림 관리
- **Grafana**: 대시보드
- **Jenkins**: 파이프라인 실행

### 저장소 정보
- **Repository**: https://github.com/zzambab98/vm-autoscaling.git
- **Branch**: main
- **Latest Commit**: 1a963e2

---

## 🔄 업데이트 이력

### 2025-11-27
- VM 목록 조회 기능 개선
- IP 주소 자동 조회 기능 추가
- 병렬 처리로 성능 개선
- UI/UX 개선
- 문서화 완료

---

**문서 작성자**: Auto (AI Assistant)  
**최종 수정일**: 2025-11-27

