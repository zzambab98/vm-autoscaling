# VM 오토스케일링 자동화 시스템 작업 계획서

**작성일**: 2025-11-20  
**버전**: 1.0  
**프로젝트**: VM-Autoscaling

---

## 📋 목차

1. [전체 작업 개요](#전체-작업-개요)
2. [Phase 1: 템플릿 관리 시스템](#phase-1-템플릿-관리-시스템)
3. [Phase 2: 오토스케일링 설정 시스템](#phase-2-오토스케일링-설정-시스템)
4. [Phase 3: PLG Stack 연동](#phase-3-plg-stack-연동)
5. [Phase 4: Jenkins 파이프라인 구현](#phase-4-jenkins-파이프라인-구현)
6. [Phase 5: Frontend UI 구현](#phase-5-frontend-ui-구현)
7. [Phase 6: 통합 테스트 및 배포](#phase-6-통합-테스트-및-배포)
8. [작업 체크리스트](#작업-체크리스트)

---

## 전체 작업 개요

### ⚠️ 중요: 전제 조건

이 시스템을 사용하기 전에 다음 조건들이 **반드시** 충족되어야 합니다:

1. **기존 서버 배포 완료**: 최소 2대 이상의 VM이 이미 배포되어 있어야 함
2. **F5 L4 Pool 구성 완료**: F5 L4 Pool이 이미 생성되어 있고, 기존 서버들이 Member로 등록되어 있어야 함
3. **PLG Stack 모니터링**: Prometheus가 기존 서버들을 모니터링 중이어야 함

> **상세 내용**: [전제 조건 및 준비사항](./전제-조건-및-준비사항.md) 문서 참조

### 작업 기간
- **총 예상 기간**: 10주 (약 2.5개월)
- **시작일**: 2025-11-20
- **목표 완료일**: 2026-02-01

### 작업 단계별 기간

| Phase | 작업 내용 | 예상 기간 | 우선순위 |
|-------|----------|----------|---------|
| **Phase 1** | 템플릿 관리 시스템 | 2주 | 높음 |
| **Phase 2** | 오토스케일링 설정 시스템 | 2주 | 높음 |
| **Phase 3** | PLG Stack 연동 | 2주 | 높음 |
| **Phase 4** | Jenkins 파이프라인 구현 | 2주 | 높음 |
| **Phase 5** | Frontend UI 구현 | 1주 | 중간 |
| **Phase 6** | 통합 테스트 및 배포 | 1주 | 높음 |

### 작업 의존성

```
Phase 1 (템플릿 관리)
  ↓
Phase 2 (오토스케일링 설정) ← Phase 1 완료 필요
  ↓
Phase 3 (PLG Stack 연동) ← Phase 2 완료 필요
  ↓
Phase 4 (Jenkins 파이프라인) ← Phase 2, 3 완료 필요
  ↓
Phase 5 (Frontend UI) ← Phase 1, 2 완료 필요
  ↓
Phase 6 (통합 테스트) ← 모든 Phase 완료 필요
```

---

## Phase 1: 템플릿 관리 시스템

**기간**: 2주  
**우선순위**: 높음  
**의존성**: 없음

### 목표
- 배포된 VM을 템플릿으로 변환하는 기능 구현
- 템플릿 메타데이터 저장 및 관리
- 템플릿 목록 조회 및 삭제 기능

### 작업 항목

#### 1.1 Backend API 구현 (1주)

**작업 내용**:
- [ ] 템플릿 생성 API (`POST /api/templates`)
- [ ] 템플릿 목록 조회 API (`GET /api/templates`)
- [ ] 템플릿 상세 조회 API (`GET /api/templates/:id`)
- [ ] 템플릿 삭제 API (`DELETE /api/templates/:id`)
- [ ] vCenter API 연동 (VM → Template 변환)

**상세 작업**:

1. **템플릿 서비스 구현** (`backend/src/services/templateService.js`)
   - [ ] `convertVmToTemplate()` 함수 구현
     - govc 명령어로 VM을 템플릿으로 변환
     - 에러 처리 및 로깅
   - [ ] `saveTemplateMetadata()` 함수 구현
     - JSON 파일에 템플릿 메타데이터 저장
     - 중복 체크 및 유효성 검증
   - [ ] `getTemplates()` 함수 구현
     - 템플릿 목록 조회
   - [ ] `getTemplateById()` 함수 구현
     - 특정 템플릿 조회
   - [ ] `deleteTemplate()` 함수 구현
     - 템플릿 삭제 (vCenter 및 메타데이터)

2. **API 엔드포인트 구현** (`backend/src/server.js` 또는 `backend/src/routes/templates.js`)
   - [ ] 템플릿 생성 엔드포인트
   - [ ] 템플릿 목록 조회 엔드포인트
   - [ ] 템플릿 상세 조회 엔드포인트
   - [ ] 템플릿 삭제 엔드포인트
   - [ ] 에러 처리 미들웨어

3. **데이터 저장소 설정**
   - [ ] `data/templates.json` 파일 구조 정의
   - [ ] 파일 읽기/쓰기 유틸리티 함수
   - [ ] 데이터 백업 메커니즘

**기술 스택**:
- Node.js + Express
- govc CLI (vCenter API)
- JSON 파일 저장소

**테스트 항목**:
- [ ] 템플릿 생성 성공 케이스
- [ ] 템플릿 생성 실패 케이스 (VM 없음, 권한 없음)
- [ ] 템플릿 목록 조회
- [ ] 템플릿 삭제

#### 1.2 Frontend UI 구현 (1주)

**작업 내용**:
- [ ] 템플릿 목록 화면
- [ ] 템플릿 생성 화면
- [ ] 템플릿 상세 화면

**상세 작업**:

1. **템플릿 목록 컴포넌트** (`frontend/src/components/TemplateList.jsx`)
   - [ ] 템플릿 목록 테이블
   - [ ] 템플릿 검색 기능
   - [ ] 템플릿 필터링 (생성일, 상태 등)
   - [ ] 템플릿 삭제 버튼 및 확인 다이얼로그

2. **템플릿 생성 컴포넌트** (`frontend/src/components/TemplateForm.jsx`)
   - [ ] 템플릿 이름 입력
   - [ ] 설명 입력
   - [ ] 원본 VM 선택 (드롭다운)
   - [ ] 생성 버튼 및 로딩 상태
   - [ ] 성공/실패 메시지 표시

3. **템플릿 상세 컴포넌트** (`frontend/src/components/TemplateDetail.jsx`)
   - [ ] 템플릿 정보 표시
   - [ ] 원본 VM 정보 표시
   - [ ] 생성일, 수정일 표시

4. **API 클라이언트** (`frontend/src/services/templateApi.js`)
   - [ ] `createTemplate()` 함수
   - [ ] `getTemplates()` 함수
   - [ ] `getTemplateById()` 함수
   - [ ] `deleteTemplate()` 함수
   - [ ] 에러 처리

**기술 스택**:
- React + Vite
- Axios (API 호출)
- React Router (라우팅)

**테스트 항목**:
- [ ] 템플릿 목록 렌더링
- [ ] 템플릿 생성 폼 제출
- [ ] 템플릿 삭제 확인 다이얼로그
- [ ] 에러 메시지 표시

---

## Phase 2: 오토스케일링 설정 시스템

**기간**: 2주  
**우선순위**: 높음  
**의존성**: Phase 1 완료

### 목표
- 오토스케일링 설정 CRUD 기능 구현
- 설정 활성화/비활성화 기능
- 설정 검증 로직

### 작업 항목

#### 2.1 Backend API 구현 (1주)

**작업 내용**:
- [ ] 오토스케일링 설정 생성 API (`POST /api/autoscaling/configs`)
- [ ] 설정 목록 조회 API (`GET /api/autoscaling/configs`)
- [ ] 설정 상세 조회 API (`GET /api/autoscaling/configs/:id`)
- [ ] 설정 수정 API (`PUT /api/autoscaling/configs/:id`)
- [ ] 설정 삭제 API (`DELETE /api/autoscaling/configs/:id`)
- [ ] 설정 활성화/비활성화 API (`POST /api/autoscaling/configs/:id/enable`, `disable`)

**상세 작업**:

1. **오토스케일링 서비스 구현** (`backend/src/services/autoscalingService.js`)
   - [ ] `saveConfig()` 함수 구현
     - 설정 데이터 저장
     - 유효성 검증 (필수 필드, 값 범위 등)
   - [ ] `getConfigs()` 함수 구현
     - 설정 목록 조회
     - 필터링 (활성화/비활성화, 서비스별)
   - [ ] `getConfigById()` 함수 구현
     - 특정 설정 조회
   - [ ] `updateConfig()` 함수 구현
     - 설정 수정
     - 부분 업데이트 지원
   - [ ] `deleteConfig()` 함수 구현
     - 설정 삭제
     - 관련 리소스 정리 (Jenkins Job 등)
   - [ ] `setConfigEnabled()` 함수 구현
     - 설정 활성화/비활성화
     - 관련 리소스 상태 변경

2. **설정 검증 로직**
   - [ ] 필수 필드 검증
   - [ ] 값 범위 검증 (CPU 임계값 0-100, 최소/최대 VM 수 등)
   - [ ] IP Pool 범위 검증
   - [ ] 템플릿 존재 여부 확인
   - [ ] F5 Pool 정보 검증

3. **데이터 저장소 설정**
   - [ ] `data/autoscaling-configs.json` 파일 구조 정의
   - [ ] 설정 버전 관리
   - [ ] 설정 변경 이력 추적

**테스트 항목**:
- [ ] 설정 생성 성공 케이스
- [ ] 설정 생성 실패 케이스 (유효성 검증 실패)
- [ ] 설정 수정
- [ ] 설정 활성화/비활성화
- [ ] 설정 삭제

#### 2.2 Frontend UI 구현 (1주)

**작업 내용**:
- [ ] 오토스케일링 설정 목록 화면
- [ ] 설정 생성/수정 화면
- [ ] 설정 상세 화면

**상세 작업**:

1. **설정 목록 컴포넌트** (`frontend/src/components/AutoscalingConfigList.jsx`)
   - [ ] 설정 목록 테이블
   - [ ] 서비스별 필터링
   - [ ] 활성화/비활성화 상태 표시
   - [ ] 설정 활성화/비활성화 토글 버튼
   - [ ] 설정 삭제 버튼

2. **설정 생성/수정 컴포넌트** (`frontend/src/components/AutoscalingConfigForm.jsx`)
   - [ ] 기본 정보 입력 (서비스 선택, 템플릿 선택)
   - [ ] 모니터링 설정 입력
     - CPU 임계값 슬라이더
     - Memory 임계값 슬라이더
     - 지속 시간 입력
     - Prometheus Job 이름 입력
   - [ ] 스케일링 설정 입력
     - 최소/최대 VM 수 입력
     - Scale Out/In Step 입력
     - Cooldown Period 입력
   - [ ] F5 설정 입력
     - Pool 이름 입력
     - VIP 주소 입력
     - VIP 포트 입력
     - Health Check 경로 입력
   - [ ] 네트워크 설정 입력
     - IP Pool 범위 입력
     - VLAN 선택
     - 게이트웨이 입력
   - [ ] 폼 검증
   - [ ] 제출 버튼 및 로딩 상태

3. **설정 상세 컴포넌트** (`frontend/src/components/AutoscalingConfigDetail.jsx`)
   - [ ] 설정 정보 표시
   - [ ] 설정 수정 버튼
   - [ ] 설정 삭제 버튼
   - [ ] 활성화/비활성화 토글

4. **API 클라이언트** (`frontend/src/services/autoscalingApi.js`)
   - [ ] `createConfig()` 함수
   - [ ] `getConfigs()` 함수
   - [ ] `getConfigById()` 함수
   - [ ] `updateConfig()` 함수
   - [ ] `deleteConfig()` 함수
   - [ ] `enableConfig()` 함수
   - [ ] `disableConfig()` 함수

**테스트 항목**:
- [ ] 설정 목록 렌더링
- [ ] 설정 생성 폼 제출
- [ ] 설정 수정
- [ ] 설정 활성화/비활성화 토글
- [ ] 폼 검증 (필수 필드, 값 범위)

---

## Phase 3: PLG Stack 연동

**기간**: 2주  
**우선순위**: 높음  
**의존성**: Phase 2 완료

### 목표
- Prometheus Alert Rule 자동 생성
- Alertmanager Webhook 설정 자동화
- Prometheus Job 자동 추가

### 작업 항목

#### 3.1 Prometheus 연동 (1주)

**작업 내용**:
- [ ] Prometheus Alert Rule 생성 API
- [ ] Prometheus Job 추가 API
- [ ] PLG Stack 서버 SSH 연동

**상세 작업**:

1. **Prometheus 서비스 구현** (`backend/src/services/prometheusService.js`)
   - [ ] `createAlertRule()` 함수 구현
     - Alert Rule YAML 생성
     - PLG Stack 서버에 SSH로 파일 추가
     - Prometheus 컨테이너 재시작
   - [ ] `addPrometheusJob()` 함수 구현
     - Prometheus 설정 파일에 새 Job 추가
     - YAML 파싱 및 수정
     - Prometheus 컨테이너 재시작
   - [ ] `deleteAlertRule()` 함수 구현
     - Alert Rule 삭제
   - [ ] SSH 연결 유틸리티
     - SSH 키 기반 인증
     - 명령어 실행 함수

2. **YAML 파싱 라이브러리**
   - [ ] `js-yaml` 라이브러리 설치
   - [ ] YAML 파일 읽기/쓰기 함수
   - [ ] YAML 구조 유지하면서 수정

3. **Alert Rule 템플릿**
   - [ ] Alert Rule YAML 템플릿 정의
   - [ ] 변수 치환 로직
   - [ ] 여러 Alert Rule 그룹 지원

**테스트 항목**:
- [ ] Alert Rule 생성 및 Prometheus 반영
- [ ] Prometheus Job 추가 및 반영
- [ ] SSH 연결 및 파일 수정
- [ ] Prometheus 컨테이너 재시작

#### 3.2 Alertmanager 연동 (1주)

**작업 내용**:
- [ ] Alertmanager 라우팅 규칙 자동 추가
- [ ] 서비스별 Webhook 수신자 생성

**상세 작업**:

1. **Alertmanager 서비스 구현** (`backend/src/services/alertmanagerService.js`)
   - [ ] `addRoutingRule()` 함수 구현
     - Alertmanager 설정 파일에 라우팅 규칙 추가
     - 서비스별 라우팅 규칙 생성
   - [ ] `addWebhookReceiver()` 함수 구현
     - Webhook 수신자 추가
     - Jenkins Webhook URL 생성
   - [ ] `updateAlertmanagerConfig()` 함수 구현
     - 설정 파일 업데이트
     - Alertmanager 컨테이너 재시작

2. **라우팅 규칙 템플릿**
   - [ ] 라우팅 규칙 YAML 템플릿
   - [ ] 서비스별 라우팅 규칙 생성 로직

**테스트 항목**:
- [ ] 라우팅 규칙 추가 및 Alertmanager 반영
- [ ] Webhook 수신자 추가
- [ ] Alertmanager 컨테이너 재시작

---

## Phase 4: Jenkins 파이프라인 구현

**기간**: 2주  
**우선순위**: 높음  
**의존성**: Phase 2, 3 완료

### 목표
- 서비스별 Jenkins Job 자동 생성
- 자동 스케일아웃 파이프라인 구현
- IP Pool 관리 및 F5 연동

### 작업 항목

#### 4.1 Jenkins Job 자동 생성 (1주)

**작업 내용**:
- [ ] Jenkins Job 생성 API
- [ ] Jenkins Job XML 생성 로직
- [ ] Generic Webhook Trigger 설정

**상세 작업**:

1. **Jenkins 서비스 구현** (`backend/src/services/jenkinsService.js`)
   - [ ] `createJenkinsJob()` 함수 구현
     - Jenkins API를 통한 Job 생성
     - Job XML 생성
     - Generic Webhook Trigger 설정
   - [ ] `deleteJenkinsJob()` 함수 구현
     - Jenkins Job 삭제
   - [ ] `updateJenkinsJob()` 함수 구현
     - Jenkins Job 설정 업데이트
   - [ ] `getJenkinsJobStatus()` 함수 구현
     - Job 상태 조회
     - 빌드 상태 조회

2. **Job XML 생성 로직**
   - [ ] Job XML 템플릿 정의
   - [ ] 서비스별 설정 반영
   - [ ] Webhook Token 설정

3. **Jenkins API 클라이언트**
   - [ ] Jenkins REST API 호출 함수
   - [ ] 인증 처리 (Basic Auth)
   - [ ] 에러 처리 및 재시도 로직

**테스트 항목**:
- [ ] Jenkins Job 생성 성공
- [ ] Webhook Trigger 설정 확인
- [ ] Jenkins Job 삭제

#### 4.2 자동 스케일아웃 파이프라인 (1주)

**작업 내용**:
- [ ] Jenkinsfile.autoscale 작성
- [ ] IP Pool 관리 스크립트
- [ ] F5 Pool Member 추가 스크립트
- [ ] VM 생성 스크립트

**상세 작업**:

1. **Jenkinsfile 작성** (`jenkins/Jenkinsfile.autoscale`)
   - [ ] Webhook 파라미터 파싱
   - [ ] IP Pool에서 사용 가능한 IP 조회
   - [ ] Ping 테스트
   - [ ] VM 생성 (템플릿에서 Clone)
   - [ ] VM 부팅 대기
   - [ ] Health Check
   - [ ] F5 Pool Member 추가
   - [ ] 에러 처리 및 롤백

2. **스크립트 작성**
   - [ ] `scripts/get-available-ip.py` - IP Pool 관리
   - [ ] `scripts/add-f5-pool-member.py` - F5 연동
   - [ ] `scripts/create-vm-from-template.sh` - VM 생성
   - [ ] `scripts/health-check.sh` - Health Check

3. **IP Pool 관리**
   - [ ] IP 범위 검증
   - [ ] 사용 중인 IP 추적
   - [ ] IP 할당/해제 로직

**테스트 항목**:
- [ ] 파이프라인 전체 실행
- [ ] IP 할당 및 Ping 테스트
- [ ] VM 생성 및 부팅
- [ ] F5 Pool Member 추가
- [ ] 에러 시나리오 테스트

---

## Phase 5: Frontend UI 구현

**기간**: 1주  
**우선순위**: 중간  
**의존성**: Phase 1, 2 완료

### 목표
- 모니터링 대시보드 구현
- 스케일아웃 이벤트 목록 화면
- 통합 UI 구현

### 작업 항목

#### 5.1 모니터링 대시보드 (3일)

**작업 내용**:
- [ ] 서비스별 메트릭 그래프
- [ ] 실시간 메트릭 조회
- [ ] 알림 목록

**상세 작업**:

1. **대시보드 컴포넌트** (`frontend/src/components/MonitoringDashboard.jsx`)
   - [ ] CPU 사용률 그래프 (Chart.js 또는 Recharts)
   - [ ] Memory 사용률 그래프
   - [ ] Response Time 그래프
   - [ ] 현재 VM 수 표시
   - [ ] 실시간 업데이트 (WebSocket 또는 Polling)

2. **메트릭 API 클라이언트** (`frontend/src/services/monitoringApi.js`)
   - [ ] `getMetrics()` 함수
   - [ ] Prometheus API 연동
   - [ ] 메트릭 데이터 변환

3. **알림 목록 컴포넌트** (`frontend/src/components/AlertList.jsx`)
   - [ ] 알림 목록 테이블
   - [ ] 알림 상태 표시 (Firing/Resolved)
   - [ ] 알림 필터링

#### 5.2 스케일아웃 이벤트 화면 (2일)

**작업 내용**:
- [ ] 이벤트 목록 화면
- [ ] 이벤트 상세 화면

**상세 작업**:

1. **이벤트 목록 컴포넌트** (`frontend/src/components/ScaleOutEventList.jsx`)
   - [ ] 이벤트 목록 테이블
   - [ ] 이벤트 필터링 (서비스별, 상태별, 날짜별)
   - [ ] 이벤트 상세 보기 버튼

2. **이벤트 상세 컴포넌트** (`frontend/src/components/ScaleOutEventDetail.jsx`)
   - [ ] 이벤트 정보 표시
   - [ ] 작업 내역 표시
   - [ ] Jenkins 파이프라인 로그 링크

---

## Phase 6: 통합 테스트 및 배포

**기간**: 1주  
**우선순위**: 높음  
**의존성**: 모든 Phase 완료

### 목표
- 전체 워크플로우 통합 테스트
- 성능 테스트
- 문서화 및 배포

### 작업 항목

#### 6.1 통합 테스트 (3일)

**작업 내용**:
- [ ] 전체 워크플로우 테스트
- [ ] 에러 시나리오 테스트
- [ ] 성능 테스트

**테스트 시나리오**:

1. **정상 워크플로우 테스트**
   - [ ] 템플릿 생성 → 오토스케일링 설정 → 모니터링 시작 → 스케일아웃 트리거 → VM 생성 → F5 추가

2. **에러 시나리오 테스트**
   - [ ] 템플릿 없음
   - [ ] IP Pool 부족
   - [ ] F5 연결 실패
   - [ ] Jenkins 파이프라인 실패

3. **동시 실행 테스트**
   - [ ] 여러 서비스 동시 스케일아웃
   - [ ] 동일 서비스 중복 스케일아웃 요청

#### 6.2 문서화 및 배포 (2일)

**작업 내용**:
- [ ] 사용자 가이드 작성
- [ ] 운영 가이드 작성
- [ ] API 문서 작성
- [ ] 배포 스크립트 작성

**문서**:
- [ ] `docs/user-guide.md` - 사용자 가이드
- [ ] `docs/operations-guide.md` - 운영 가이드
- [ ] `docs/api-reference.md` - API 참조 문서
- [ ] `docs/troubleshooting.md` - 트러블슈팅 가이드

---

## 작업 체크리스트

### Phase 1: 템플릿 관리 시스템
- [ ] Backend API 구현 완료
- [ ] Frontend UI 구현 완료
- [ ] 단위 테스트 완료
- [ ] 통합 테스트 완료

### Phase 2: 오토스케일링 설정 시스템
- [ ] Backend API 구현 완료
- [ ] Frontend UI 구현 완료
- [ ] 설정 검증 로직 완료
- [ ] 단위 테스트 완료

### Phase 3: PLG Stack 연동
- [ ] Prometheus 연동 완료
- [ ] Alertmanager 연동 완료
- [ ] SSH 연동 완료
- [ ] 테스트 완료

### Phase 4: Jenkins 파이프라인 구현
- [ ] Jenkins Job 자동 생성 완료
- [ ] 자동 스케일아웃 파이프라인 완료
- [ ] 스크립트 작성 완료
- [ ] 테스트 완료

### Phase 5: Frontend UI 구현
- [ ] 모니터링 대시보드 완료
- [ ] 스케일아웃 이벤트 화면 완료
- [ ] 통합 UI 완료

### Phase 6: 통합 테스트 및 배포
- [ ] 통합 테스트 완료
- [ ] 성능 테스트 완료
- [ ] 문서화 완료
- [ ] 배포 완료

---

## 다음 단계

1. **Phase 1 시작**: 템플릿 관리 시스템 구현
2. **주간 진행 상황 리뷰**: 매주 금요일
3. **이슈 추적**: GitHub Issues 사용
4. **코드 리뷰**: 각 Phase 완료 시

---

**작성자**: Dana Cloud Automation Team  
**최종 수정일**: 2025-11-20

